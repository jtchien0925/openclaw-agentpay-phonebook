<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>OpenClaw ‚Üî AgentPay Phone Book</title>
<style>
:root{--bg:#0d1117;--s:#161b22;--s2:#1c2333;--b:#30363d;--t:#e6edf3;--tm:#8b949e;--a:#58a6ff;--g:#3fb950;--r:#f85149;--p:#bc8cff;--rad:8px}*{box-sizing:border-box;margin:0;padding:0}body{font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;background:var(--bg);color:var(--t);min-height:100vh}.hd{background:var(--s);border-bottom:1px solid var(--b);padding:20px 32px;display:flex;align-items:center;justify-content:space-between;flex-wrap:wrap;gap:12px}.hd h1{font-size:22px;font-weight:600;display:flex;align-items:center;gap:10px}.ha{display:flex;gap:8px}.ct{max-width:1100px;margin:0 auto;padding:24px}.sb{background:var(--s);border:1px solid var(--b);border-radius:var(--rad);padding:16px 20px;margin-bottom:20px;display:flex;gap:12px;align-items:center}.sb input{flex:1;background:var(--bg);border:1px solid var(--b);border-radius:6px;padding:10px 14px;color:var(--t);font-size:14px;outline:none}.sb input:focus{border-color:var(--a)}.sb input::placeholder{color:var(--tm)}.bdg{background:var(--s2);border:1px solid var(--b);border-radius:20px;padding:6px 14px;font-size:13px;color:var(--tm);white-space:nowrap}.bdg strong{color:var(--a)}.btn{padding:8px 16px;border-radius:6px;font-size:13px;font-weight:500;cursor:pointer;border:1px solid var(--b);transition:all .15s;display:inline-flex;align-items:center;gap:6px}.bp{background:var(--g);border-color:var(--g);color:#fff}.bp:hover{filter:brightness(1.15)}.bs2{background:var(--s2);color:var(--t)}.bs2:hover{background:var(--b)}.bd{background:transparent;border-color:var(--r);color:var(--r)}.bd:hover{background:rgba(248,81,73,.1)}.ba{background:var(--a);border-color:var(--a);color:#fff}.ba:hover{filter:brightness(1.15)}.bsm{padding:5px 10px;font-size:12px}.ac{background:var(--s);border:1px solid var(--b);border-radius:var(--rad);margin-bottom:16px;overflow:hidden;transition:border-color .2s}.ac:hover{border-color:var(--a)}.ach{padding:16px 20px;display:flex;align-items:center;justify-content:space-between;border-bottom:1px solid var(--b);cursor:pointer}.ach:hover{background:var(--s2)}.aig{display:flex;align-items:center;gap:12px}.av{width:36px;height:36px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:16px;font-weight:700;color:#fff}.an{font-weight:600;font-size:15px}.ait{background:var(--s2);border:1px solid var(--b);border-radius:4px;padding:2px 8px;font-size:12px;font-family:monospace;color:var(--a)}.cbs{display:flex;gap:6px}.cb{font-size:11px;padding:3px 8px;border-radius:12px;font-weight:500}.cb.base{background:rgba(88,166,255,.15);color:var(--a)}.cb.solana{background:rgba(188,140,255,.15);color:var(--p)}.acb{padding:20px;display:none}.acb.open{display:block}.sl{font-size:11px;font-weight:600;text-transform:uppercase;letter-spacing:.5px;color:var(--tm);margin-bottom:8px;margin-top:16px}.sl:first-child{margin-top:0}.wr,.br{display:flex;align-items:center;gap:10px;padding:8px 12px;background:var(--bg);border:1px solid var(--b);border-radius:6px;margin-bottom:6px;font-family:monospace;font-size:13px}.wr .cl{font-family:-apple-system,sans-serif;font-weight:600;font-size:12px;min-width:55px}.wr .ad{flex:1;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.br .ci{font-size:14px;min-width:20px;text-align:center}.br .cn{font-weight:600;min-width:80px;font-family:-apple-system,sans-serif;font-size:12px}.br .pi{flex:1;color:var(--tm)}.cpb{background:none;border:none;color:var(--tm);cursor:pointer;padding:4px;font-size:14px;border-radius:4px}.cpb:hover{color:var(--a);background:var(--s2)}.mo{display:none;position:fixed;inset:0;background:rgba(0,0,0,.6);z-index:100;align-items:center;justify-content:center}.mo.open{display:flex}.md{background:var(--s);border:1px solid var(--b);border-radius:12px;width:560px;max-height:85vh;overflow-y:auto;padding:24px}.md h2{font-size:18px;margin-bottom:20px;display:flex;align-items:center;gap:8px}.fg{margin-bottom:16px}.fg label{display:block;font-size:13px;font-weight:500;margin-bottom:6px;color:var(--tm)}.fg input,.fg select{width:100%;background:var(--bg);border:1px solid var(--b);border-radius:6px;padding:10px 12px;color:var(--t);font-size:14px;outline:none}.fg input:focus,.fg select:focus{border-color:var(--a)}.fg input::placeholder{color:var(--tm)}.fr{display:flex;gap:12px}.fr .fg{flex:1}.dl{background:var(--bg);border:1px solid var(--b);border-radius:6px;padding:12px;margin-bottom:16px}.dlh{display:flex;justify-content:space-between;align-items:center;margin-bottom:10px}.dlh span{font-size:13px;font-weight:500;color:var(--tm)}.di{display:flex;gap:8px;align-items:center;margin-bottom:8px}.di input,.di select{flex:1;background:var(--s);border:1px solid var(--b);border-radius:6px;padding:8px 10px;color:var(--t);font-size:13px;outline:none}.di input:focus,.di select:focus{border-color:var(--a)}.ma{display:flex;justify-content:flex-end;gap:8px;margin-top:24px;padding-top:16px;border-top:1px solid var(--b)}.jp{background:var(--bg);border:1px solid var(--b);border-radius:6px;padding:16px;font-family:monospace;font-size:12px;white-space:pre-wrap;max-height:400px;overflow-y:auto;color:var(--tm);line-height:1.5}.toast{position:fixed;bottom:24px;right:24px;background:var(--g);color:#fff;padding:12px 20px;border-radius:8px;font-size:14px;font-weight:500;z-index:200;opacity:0;transform:translateY(10px);transition:all .3s;pointer-events:none}.toast.show{opacity:1;transform:translateY(0)}.es{text-align:center;padding:60px 20px;color:var(--tm)}.es .icon{font-size:48px;margin-bottom:16px}.es h3{font-size:18px;color:var(--t);margin-bottom:8px}.es p{font-size:14px;margin-bottom:20px}.ia{border:2px dashed var(--b);border-radius:8px;padding:24px;text-align:center;margin-bottom:16px;cursor:pointer}.ia:hover{border-color:var(--a)}.ia p{font-size:13px;color:var(--tm)}@media(max-width:640px){.ct{padding:12px}.hd{padding:14px 16px}.fr{flex-direction:column}.md{width:95%;margin:0 10px}.sb{flex-direction:column}}
</style></head><body>
<div class="hd"><h1><span style="font-size:28px">üìû</span> OpenClaw ‚Üî AgentPay Phone Book</h1><div class="ha"><button class="btn bs2" onclick="openImportModal()">‚¨Ü Import JSON</button><button class="btn bs2" onclick="openExportModal()">‚¨á Export JSON</button><button class="btn bp" onclick="openAddModal()">+ Add Agent</button></div></div>
<div class="ct"><div class="sb"><input type="text" id="searchInput" placeholder="Search by agent ID, wallet address, channel, or display name..." oninput="renderAgents()"><div class="bdg"><strong id="agentCount">0</strong> agents</div><div class="bdg"><strong id="walletCount">0</strong> wallets</div></div><div id="agentList"></div></div><div class="mo" id="agentModal"><div class="md"><h2 id="modalTitle">+ Add New Agent</h2><div class="fr"><div class="fg"><label>Agent ID *</label><input type="text" id="fAgentId" placeholder="e.g. main, coding, trader"></div><div class="fg"><label>Display Name</label><input type="text" id="fDisplayName" placeholder="e.g. Primary Assistant"></div></div><div class="dl"><div class="dlh"><span>Wallets</span><button class="btn bsm bs2" onclick="addWalletRow()">+ Add Wallet</button></div><div id="walletRows"></div></div><div class="dl"><div class="dlh"><span>Channel Bindings</span><button class="btn bsm bs2" onclick="addBindingRow()">+ Add Binding</button></div><div id="bindingRows"></div></div><div class="fr"><div class="fg"><label>Preferred Payer Chain</label><select id="fPayerChain"><option value="base">Base (EVM)</option><option value="solana">Solana</option></select></div><div class="fg"><label>Webhook URL (optional)</label><input type="text" id="fWebhook" placeholder="https://your-server.com/webhook"></div></div><div class="ma"><button class="btn bs2" onclick="closeModal('agentModal')">Cancel</button><button class="btn bp" onclick="saveAgent()">Save Agent</button></div></div></div>
<div class="mo" id="exportModal"><div class="md"><h2>‚¨á Export Phone Book</h2><div class="jp" id="jsonPreview"></div><div class="ma"><button class="btn bs2" onclick="closeModal('exportModal')">Close</button><button class="btn bs2" onclick="copyExport()">üìã Copy</button><button class="btn ba" onclick="downloadExport()">üíæ Download .json</button></div></div></div>
<div class="mo" id="importModal"><div class="md"><h2>‚¨Ü Import Phone Book</h2><div class="ia" onclick="document.getElementById('importFile').click()"><p>Click to select a JSON file, or paste JSON below</p><input type="file" id="importFile" accept=".json" style="display:none" onchange="handleFileImport(event)"></div><div class="fg"><label>Or paste JSON:</label><textarea id="importText" style="width:100%;height:150px;background:var(--bg);border:1px solid var(--b);border-radius:6px;padding:10px;color:var(--t);font-family:monospace;font-size:12px;resize:vertical" placeholder="Paste your phone book JSON here..."></textarea></div><div class="ma"><button class="btn bs2" onclick="closeModal('importModal')">Cancel</button><button class="btn ba" onclick="doImport()">Import</button></div></div></div>
<div class="toast" id="toast"></div>
<script>
let agents=[],editingIndex=-1;
const COLORS=["#58a6ff","#3fb950","#d29922","#bc8cff","#f85149","#79c0ff","#56d364","#e3b341"];
const CI={telegram:"‚úàÔ∏è",discord:"üéÆ",whatsapp:"üí¨",signal:"üîí",slack:"üíº",other:"üîó"};
function gc(s){let h=0;for(let i=0;i<s.length;i++)h=s.charCodeAt(i)+((h<<5)-h);return COLORS[Math.abs(h)%COLORS.length]}
function esc(s){return s?s.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;"):""}
function renderAgents(){const q=document.getElementById("searchInput").value.toLowerCase();const list=document.getElementById("agentList");const f=agents.filter(a=>{if(!q)return true;return[a.agent_id,a.display_name,...Object.values(a.wallets||{}).map(w=>w.address),...(a.account_bindings||[]).map(b=>b.channel+" "+b.account_id+" "+(b.peer_id||"")+" "+(b.guild_id||""))].join(" ").toLowerCase().includes(q)});let wt=0;agents.forEach(a=>{wt+=Object.keys(a.wallets||{}).length});document.getElementById("agentCount").textContent=agents.length;document.getElementById("walletCount").textContent=wt;if(!f.length){list.innerHTML='<div class="es"><div class="icon">'+(agents.length===0?"üìñ":"üîç")+'</div><h3>'+(agents.length===0?"No agents yet":"No matches")+'</h3><p>'+(agents.length===0?"Add your first agent to start building the phone book.":"Try a different search term.")+'</p>'+(agents.length===0?'<button class="btn bp" onclick="openAddModal()">+ Add First Agent</button>':"")+'</div>';return}list.innerHTML=f.map(a=>{const ri=agents.indexOf(a),ch=Object.keys(a.wallets||{}),col=gc(a.agent_id),ini=(a.display_name||a.agent_id).charAt(0).toUpperCase();return'<div class="ac" id="card-'+ri+'"><div class="ach" onclick="toggleCard('+ri+')"><div class="aig"><div class="av" style="background:'+col+'">'+ini+'</div><div><div class="an">'+esc(a.display_name||a.agent_id)+'</div><span class="ait">'+esc(a.agent_id)+'</span></div></div><div style="display:flex;align-items:center;gap:10px"><div class="cbs">'+ch.map(c=>'<span class="cb '+c+'">'+c+'</span>').join("")+'</div><span style="color:var(--tm);font-size:18px" id="arrow-'+ri+'">‚ñ∏</span></div></div><div class="acb" id="body-'+ri+'"><div class="sl">Wallets</div>'+ch.map(c=>{const w=a.wallets[c];return'<div class="wr"><span class="cl" style="color:'+(c==="base"?"var(--a)":"var(--p)")+'">'+c.toUpperCase()+'</span><span class="ad">'+esc(w.address)+'</span><button class="cpb" onclick="event.stopPropagation();copyText(\''+esc(w.address)+'\')">üìã</button></div>'}).join("")+((a.account_bindings&&a.account_bindings.length)?'<div class="sl">Channel Bindings</div>'+a.account_bindings.map(b=>'<div class="br"><span class="ci">'+(CI[b.channel]||CI.other)+'</span><span class="cn">'+esc(b.channel)+'</span><span class="pi">'+esc(b.account_id)+(b.peer_id?" \u00B7 peer: "+esc(b.peer_id):"")+(b.guild_id?" \u00B7 guild: "+esc(b.guild_id):"")+'</span></div>').join(""):"")+'<div class="sl">AgentPay Config</div><div class="br"><span class="ci">‚ö°</span><span class="cn">Chain</span><span class="pi">'+esc((a.agentpay||{}).preferred_payer_chain||"base")+'</span>'+((a.agentpay||{}).webhook_url?'<span class="pi" style="font-size:11px">webhook: '+esc(a.agentpay.webhook_url)+'</span>':"")+'</div><div style="margin-top:16px;display:flex;gap:8px;justify-content:flex-end"><button class="btn bsm bs2" onclick="editAgent('+ri+')">\u270F\uFE0F Edit</button><button class="btn bsm bd" onclick="deleteAgent('+ri+')">\uD83D\uDDD1 Delete</button></div></div></div>'}).join("")}
function toggleCard(i){const b=document.getElementById("body-"+i),a=document.getElementById("arrow-"+i);b.classList.toggle("open");a.textContent=b.classList.contains("open")?"‚ñæ":"‚ñ∏"}
function openAddModal(){editingIndex=-1;document.getElementById("modalTitle").textContent="+ Add New Agent";document.getElementById("fAgentId").value="";document.getElementById("fDisplayName").value="";document.getElementById("fPayerChain").value="base";document.getElementById("fWebhook").value="";document.getElementById("walletRows").innerHTML="";document.getElementById("bindingRows").innerHTML="";addWalletRow();addBindingRow();openModal("agentModal")}
function editAgent(i){editingIndex=i;const a=agents[i];document.getElementById("modalTitle").textContent="Edit Agent";document.getElementById("fAgentId").value=a.agent_id;document.getElementById("fDisplayName").value=a.display_name||"";document.getElementById("fPayerChain").value=(a.agentpay||{}).preferred_payer_chain||"base";document.getElementById("fWebhook").value=(a.agentpay||{}).webhook_url||"";document.getElementById("walletRows").innerHTML="";const w=a.wallets||{};if(!Object.keys(w).length)addWalletRow();else Object.entries(w).forEach(([c,v])=>addWalletRow(c,v.address));document.getElementById("bindingRows").innerHTML="";const bn=a.account_bindings||[];if(!bn.length)addBindingRow();else bn.forEach(b=>addBindingRow(b.channel,b.account_id,b.peer_id||b.guild_id||""));openModal("agentModal")}
function addWalletRow(c,addr){const d=document.createElement("div");d.className="di";d.innerHTML='<select style="max-width:110px"><option value="base"'+(c==="base"?" selected":"")+'>Base (EVM)</option><option value="solana"'+(c==="solana"?" selected":"")+'>Solana</option></select><input type="text" placeholder="0x... or base58 address" value="'+esc(addr||"")+'"><button class="btn bsm bd" onclick="this.parentElement.remove()" style="padding:5px 8px">\u2715</button>';document.getElementById("walletRows").appendChild(d)}
function addBindingRow(ch,aid,pid){const d=document.createElement("div");d.className="di";d.innerHTML='<select style="max-width:110px"><option value="telegram"'+(ch==="telegram"?" selected":"")+'>Telegram</option><option value="discord"'+(ch==="discord"?" selected":"")+'>Discord</option><option value="whatsapp"'+(ch==="whatsapp"?" selected":"")+'>WhatsApp</option><option value="signal"'+(ch==="signal"?" selected":"")+'>Signal</option><option value="slack"'+(ch==="slack"?" selected":"")+'>Slack</option></select><input type="text" placeholder="Account ID" value="'+esc(aid||"")+'" style="max-width:140px"><input type="text" placeholder="Peer/Guild ID" value="'+esc(pid||"")+ '"><button class="btn bsm bd" onclick="this.parentElement.remove()" style="padding:5px 8px">\u2715</button>';document.getElementById("bindingRows").appendChild(d)}
function saveAgent(){const id=document.getElementById("fAgentId").value.trim();if(!id){toast("Agent ID is required",1);return}if(editingIndex===-1&&agents.some(a=>a.agent_id===id)){toast("Agent ID already exists",1);return}const dn=document.getElementById("fDisplayName").value.trim(),pc=document.getElementById("fPayerChain").value,wh=document.getElementById("fWebhook").value.trim();const wallets={};document.querySelectorAll("#walletRows .di").forEach(r=>{const c=r.querySelector("select").value,a=r.querySelector("input").value.trim();if(a)wallets[c]={address:a,type:c==="base"?"evm":"solana",source:"manual",usdc_enabled:true}});if(!Object.keys(wallets).length){toast("At least one wallet required",1);return}const bindings=[];document.querySelectorAll("#bindingRows .di").forEach(r=>{const ins=r.querySelectorAll("input"),ch=r.querySelector("select").value,ai=ins[0].value.trim(),pi=ins[1].value.trim();if(ai){const b={channel:ch,account_id:ai};if(ch==="discord")b.guild_id=pi;else b.peer_id=pi;bindings.push(b)}});const agent={agent_id:id,display_name:dn||id,account_bindings:bindings,wallets,agentpay:{preferred_payer_chain:pc,auto_receive:true,...(wh?{webhook_url:wh}:{})}};if(editingIndex>=0){agents[editingIndex]=agent;toast("Agent updated")}else{agents.push(agent);toast("Agent added")}closeModal("agentModal");renderAgents();saveLocal()}
function deleteAgent(i){if(!confirm("Delete agent \""+agents[i].agent_id+"\"?"))return;agents.splice(i,1);renderAgents();saveLocal();toast("Agent deleted")}
function buildExport(){const bw={},bcp={};agents.forEach(a=>{Object.values(a.wallets||{}).forEach(w=>{bw[w.address]=a.agent_id});(a.account_bindings||[]).forEach(b=>{bcp[b.channel+":"+(b.peer_id||b.guild_id||b.account_id)]=a.agent_id})});return{"$schema":"openclaw-agentpay-phonebook/v1",description:"Phone book registry linking OpenClaw bot agent IDs to on-chain wallet addresses for AgentPay (X402) USDC payments.",metadata:{created:new Date().toISOString().split("T")[0],version:"1.0.0",supported_chains:["base","solana"],payment_protocol:"x402",agentpay_api:"https://api-pay.agent.tech"},agents,lookup_indexes:{by_wallet:bw,by_channel_peer:bcp}}}
function openExportModal(){document.getElementById("jsonPreview").textContent=JSON.stringify(buildExport(),null,2);openModal("exportModal")}
function copyExport(){navigator.clipboard.writeText(JSON.stringify(buildExport(),null,2));toast("Copied to clipboard")}
function downloadExport(){const b=new Blob([JSON.stringify(buildExport(),null,2)],{type:"application/json"});const u=URL.createObjectURL(b);const a=document.createElement("a");a.href=u;a.download="openclaw-agentpay-phonebook.json";a.click();URL.revokeObjectURL(u);toast("Downloaded")}
function openImportModal(){document.getElementById("importText").value="";openModal("importModal")}
function handleFileImport(e){const f=e.target.files[0];if(!f)return;const r=new FileReader();r.onload=ev=>{document.getElementById("importText").value=ev.target.result};r.readAsText(f)}
function doImport(){const t=document.getElementById("importText").value.trim();if(!t){toast("No data to import",1);return}try{const d=JSON.parse(t);if(d.agents&&Array.isArray(d.agents)){agents=d.agents;renderAgents();saveLocal();closeModal("importModal");toast("Imported "+agents.length+" agents")}else toast("Invalid format",1)}catch(e){toast("Invalid JSON: "+e.message,1)}}
function openModal(id){document.getElementById(id).classList.add("open")}
function closeModal(id){document.getElementById(id).classList.remove("open")}
function copyText(t){navigator.clipboard.writeText(t);toast("Copied: "+t.slice(0,20)+"...")}
function toast(m,err){const e=document.getElementById("toast");e.textContent=m;e.style.background=err?"var(--r)":"var(--g)";e.classList.add("show");setTimeout(()=>e.classList.remove("show"),2500)}
function saveLocal(){try{sessionStorage.setItem("pb",JSON.stringify(agents))}catch(e){}}
function loadLocal(){try{const d=sessionStorage.getItem("pb");if(d)agents=JSON.parse(d)}catch(e){}}
document.querySelectorAll(".mo").forEach(el=>{el.addEventListener("click",e=>{if(e.target===el)el.classList.remove("open")})});
document.addEventListener("keydown",e=>{if(e.key==="Escape")document.querySelectorAll(".mo.open").forEach(m=>m.classList.remove("open"))});
loadLocal();renderAgents();
</script></body></html>